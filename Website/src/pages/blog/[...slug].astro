---
import Header from '../../components/Header.astro';
import Footer from '../../components/Footer.astro';
import { fetchRecipes } from '../../dataFetch';
import type { RecipePost } from '../../../types';
import "../../styles/post.css";

interface Post {
  id: string;
  slug: string;
  body: string;
  collection: string;
  data: RecipePost;
}

export async function getStaticPaths() {
  const posts: Post[] = await fetchRecipes();
  return {
    paths: posts.map((post) => ({
      params: { slug: post.slug },
    })),
    fallback: false,
  };
}

const posts: Post[] = await fetchRecipes();
const { slug } = Astro.params;
const post = posts.find((p) => p.slug === slug);

if (!post) {
  throw new Error(`Post not found for slug: ${slug}`);
}
---

<html lang="en">
<head>
  <link rel="stylesheet" href="/styles/global.css">
  <link rel="stylesheet" href="/styles/post.css">
</head>
<body>
  <div class="header-wrapper">
    <div class="header">
      <Header />
    </div>
  </div>
  <div class="container">
    <main class="post-main">
      <h1>{post.data.title}</h1>
      <div class="post-meta">
        <span class="servings">Serves: {post.data.servings}</span>
        <span class="prep-time">Prep Time: {post.data.prepTime}</span>
        <span class="cook-time">Cook Time: {post.data.cookTime}</span>
      </div>
      <img src={post.data.image} alt={post.data.title} class="post-image" />
      <div class="post-content">
        <div class="post-directions">
          <h2>Directions:</h2>
          <p>{post.data.directions}</p>
        </div>
        <div class="post-ingredients">
          <h2>Ingredients:</h2>
          <p>{post.data.ingredients}</p>
        </div>
      </div>
      <div class="post-tags">
        <h3>Tags</h3>
        <div class="tags">
            {post.data.tags && post.data.tags.map(tag => (
            <span class="tag">{tag}</span>
          ))}
        </div>
      </div>
      <div class="post-votes">
        <button><img src="/images/up.png" alt="Up arrow"></button>
        <span>0</span>
        <button><img src="/images/down.png" alt="Down arrow"></button>
        <button class="suggest-button">SUGGEST</button>
      </div>
      <div class="post-comments">
        <h3>Comments</h3>
        {post.data.comments && post.data.comments.map(comment => (
          <div class="comment">
            <div class="comment-votes">
              <button><img src="/images/up.png" alt="Up arrow"></button>
              <span>0</span>
              <button><img src="/images/down.png" alt="Down arrow"></button>
            </div>
            <div class="comment-content">
              <h4>{comment.author}</h4>
              <p>{comment.text}</p>
            </div>
          </div>
        ))}
      </div>
      <div class="post-suggestions">
        <h3>Suggested Changes</h3>
        {post.data.suggestions && post.data.suggestions.map(suggestion => (
          <div class="suggestion">
            <div class="suggestion-votes">
              <button><img src="/images/up.png" alt="Up arrow"></button>
              <span>0</span>
              <button><img src="/images/down.png" alt="Down arrow"></button>
            </div>
            <div class="suggestion-content">
              <h4>{suggestion.author}</h4>
              <p>{suggestion.text}</p>
            </div>
          </div>
        ))}
      </div>
    </main>
    <Footer />
  </div>
</body>
</html>
