---
import Header from '../../components/Header.astro';
import Footer from '../../components/Footer.astro';
import { fetchRecipes } from '../../dataFetch';
import "../../styles/post.css";

interface Recipe {
  Author: string;
  Title: string;
  Image: string;
  Instructions: string;
  Ingredients: string[];
  Tags: string[];
  PrepTime: string;
  CookTime: string;
  Servings: string;
  Slug: string;
}

export async function getStaticPaths() {
  const recipes: Recipe[] = await fetchRecipes();
  return recipes.map((recipe) => ({
    params: { slug: recipe.Slug }
  }));
}

const { slug } = Astro.params;
const recipes: Recipe[] = await fetchRecipes();
const recipe = recipes.find((r) => r.Slug === slug);

if (!recipe) {
  throw new Error(`Recipe not found for slug: ${slug}`);
}
---

<html lang="en">
<head>
  <link rel="stylesheet" href="/styles/global.css">
  <link rel="stylesheet" href="/styles/post.css">
</head>
<body>
  <Header />
  <main class="post-main">
    <h1>{recipe.Title}</h1>
    <div class="post-meta">
      <span class="servings">Serves: {recipe.Servings}</span>
      <span class="prep-time">Prep Time: {recipe.PrepTime}</span>
      <span class="cook-time">Cook Time: {recipe.CookTime}</span>
    </div>
    <img src={recipe.Image} alt={recipe.Title} class="post-image" />
    <div class="post-content">
      <div class="post-directions">
        <h2>Directions:</h2>
        <p>{recipe.Instructions}</p>
      </div>
      <div class="post-ingredients">
        <h2>Ingredients:</h2>
        <ul>
          {recipe.Ingredients.map(ingredient => (
            <li>{ingredient}</li>
          ))}
        </ul>
      </div>
    </div>
    <div class="post-tags">
      <h3>Tags</h3>
      <div class="tags">
        {recipe.Tags.map(tag => (
          <span class="tag">{tag}</span>
        ))}
      </div>
    </div>
  </main>
  <Footer />
</body>
</html>

<style>
/* Add styles to match your design */
.post-main {
  max-width: 800px;
  margin: 0 auto;
  padding: 20px;
}

.post-meta {
  display: flex;
  justify-content: space-around;
  margin-bottom: 20px;
}

.post-image {
  width: 100%;
  height: auto;
  margin-bottom: 20px;
}

.post-content {
  display: flex;
  justify-content: space-between;
}

.post-directions, .post-ingredients {
  width: 48%;
}

.post-tags {
  margin-top: 20px;
}

.tags {
  display: flex;
  gap: 10px;
  flex-wrap: wrap;
}

.tag {
  background: #242c26;
  color: white;
  padding: 5px 10px;
  border-radius: 5px;
}

.post-votes, .post-comments, .post-suggestions {
  margin-top: 20px;
}
</style>
